\documentclass[a5paper,11pt]{book}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{xjunicode}
\usepackage[style=classic]{dramatist}
\usepackage{fancyhdr}
%\usepackage{verse}
%\usepackage{poemscol}
\usepackage{geometry}
\usepackage{zref-savepos}

\def\testodicontrollo{%
Questo re di Sparta ebbe con voi comune la morte, per giudizio
iniquo degli efori; come voi, per quello d'un ingiusto parlamento.
Ma quanto fu simile l'effetto, altrettanto diversa n'era la
cagione. Agide, col ristabilire l'uguaglianza e la libertá, volea
restituire a Sparta le sue virtú, e il suo splendore; quindi egli
pieno di gloria moriva, eterna di se lasciando la fama. Voi, col
tentare di rompere ogni limite all'autoritá vostra, falsamente il
privato vostro bene procacciarvi bramaste: nulla quindi rimane di
voi; e la sola inutile altrui compassione vi accompagnò nella
tomba.
}

% \DRSetup{versedrama}{drama}{
%   rightmargin=2em,speechskip=2ex
% }

% \makeatletter
% \DRSetup{drama}{drama}{leftmargin=0pt,
%   speaksindent=0pt,labelsep=0pt,
%   speakswidth=\dimexpr\DR@drama@leftmargin-\DR@drama@labelsep\relax,
% }
% \DRSetup{speaker}{speaker}{labelwidth=\dimexpr\textwidth-\DR@drama@leftmargin-\DR@drama@rightmargin\relax,prelabel=\hss,postlabel=\hss}

% \newlength\difference
% \setlength\difference{\dimexpr\leftmargini-\leftmarginii\relax}
% \typeout{\the\difference}

\fboxsep=-\fboxrule

\parindent=1em

%\tracingpatches

%\setlength\stanzaskip{0pt}

% \poemlines{10}

\begin{document}

\testodicontrollo

\noindent\rule{\leftmargini}{1pt}

\begin{versedrama}
  \speaker{Anfar.}
  Pur, per quanto sia giusto in te lo sdegno, Pur, per quanto sia giusto in te lo sdegno,\\
  premilo in petto, se sbramarlo or vuoi.\hspace{\stretch{1}}uè\\
  Io men di te non odio Agide altero;\hspace{\stretch{1}}uè\\
  e la sua pompa di virtudi antiche,\hspace{\stretch{1}}uè\\
  finta in biasmo di noi. Sparta ridurre\hspace{\stretch{1}}uè\\
  qual giá la fea Licurgo, è al par crudele,\hspace{\stretch{1}}uè\\
  che ambizíosa stolidezza: è tale\hspace{0pt plus 1filll} uè\\
  \speaker{Agid.}
  Pur, per quanto sia giusto in te lo sdegno,\\
  premilo in petto, se sbramarlo or vuoi.\\
  Io men di te non odio Agide altero;\\
  e la sua pompa di virtudi antiche,\\
  finta in biasmo di noi. Sparta ridurre\\
  qual giá la fea Licurgo, è al par crudele,\\
  che ambizíosa stolidezza: è tale\\
\end{versedrama}

\leftmargini=1.5em

\begin{verse}
  pure il disegno suo; quindi ebbe ei quasi\\
  la cittá nostra all'ultimo ridotta:\\
  e, sconvolta pur anco, in risse e affanni\\
  egra ella sta. Ma, van cangiando i tempi:\\
  quei traditori, efori allor, che schiavi\\
  eran d'Agesiláo, piú a lui venduti\\>
  che ad Agide, con esso ora sbanditi\\
  son tutti, o spenti: e sta in noi soli Sparta.\\
  Ma il popol rio, mendico, e ognor di nuove\\
  cose voglioso, Agide ancora elegge\\
  mezzo a sue mire ingiuste. A schietta forza,\\
  mal frenare il potremmo; ogni novello\\>
  governo erra adoprandola. Deluso,\\
  pria che sforzato, il popol sia. Tal cura,\\
  che a cor mi sta non men che a te, mi lascia.\\
  Ecco la madre d'Agide: gran donna\\
  ogni dí piú degli Spartani in core\\
  si fa costei: temer si debbe anch'ella.\\
\end{verse}

\testodicontrollo

\begin{drama}
\speaker{endymion} I find, Eumenides, in all things both variety to
content and satiety to glut, saving only in my affections,
which are so stayed, and withal so stately, that I can
neither satisfy my heart with love nor mine eyes with
wonder. My thoughts, Eumenides, are stitched to the
stars, which being as high as I can see, thou may'st
imagine how much higher they are than I can reach.

\speaker{eumenides} If you be enamored of anything above the
moon, your thoughts are ridiculous; for that things immortal
are not subject to affections. If allured or enchanted with
these transitory things under the moon, you show yourself
yourself senseless to attribute such lofty titles to such low
trifles.

\speaker{endymion} My love is placed neither under the moon nor
above.

\item[\scshape endymion] My love is placed neither under the moon nor
above.
\end{drama}

\Character[role=FILIPPO,]{FILIPPO}{filippo}
\Character[role=ISABELLA,]{ISABELLA}{isabella}
\Character[role=CARLO,]{CARLO}{carlo}
\Character[role=GOMEZ,]{GOMEZ}{gomez}
\Character[role=PEREZ,]{PEREZ}{perez}
\Character[role=LEONARDO,]{LEONARDO}{leonardo}
\Character[role=Consiglieri,]{Consiglieri}{consiglieri}
\Character[role=Guardie,]{Guardie}{guardie}

\begin{versedrama}
\speaker{Qualcuno}
crederò che nemica anima alberghi\\
tu di pietade?\\> %% Parte Iniziale
\isabellaspeaks
\dramaphantom{tu di pietade?}Il sai, qual vita io tragga,\\ %% Parte Finale
in queste soglie: di una corte austera\\
\end{versedrama}

\makeatletter
%% Patch per l'ambiente `verse'
\renewcommand{\@vscentercr}{%
  \ifhmode \unskip\else \@nolnerr\fi
  \@vsifgt{\verselinebreak}{%
    \@vstypelinenum%
    \incr@vsline
    \par\@ifstar{\nobreak\@vsxcentercr}{%
      \@vsifbang{\@ifnextchar[ {\@vsicentercr}{}}{\@vsxcentercr}}}}
\renewcommand{\verselinebreak}[1][\z@]{\par\hspace*{#1}\ignorespaces}
\def\dramaphantomx#1#2{%
  \ifnum\zposx{#2}>\zposx{#1}\hskip\dimexpr\zposx{#2}sp-\zposx{#1}sp\relax\fi
}
\newcounter{lafava}
\setcounter{lafava}{0}
\makeatother

\begin{versedrama}
\speaker{Qualcuno}
crederò che nemica anima alberghi\\
\let\origbreak\\
\def\\{\stepcounter{lafava}\zsavepos{prova:\roman{vslineno}:\roman{lafava}}\origbreak}
tu di pietade? E poi la mi' fava\\> %% Parte Iniziale
\isabellaspeaks\zsavepos{provadue:\roman{vslineno}}
\dramaphantomx{provadue:\roman{vslineno}}{prova:\roman{vslineno}:\roman{lafava}}Il sai, qual vita io tragga,\\> %% Parte Finale
in queste soglie: di una corte austera\\
\end{versedrama}

\begin{verse}
verso\\
riverso\newline
converso\newline
\item diverso
\end{verse}

\end{document}

